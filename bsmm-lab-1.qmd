---
title: "BSMM-lab-1"
subtitle: "BSMM 8740 Fall 2023"
author: "Rajasree B"
date: "2023-09-11"
format: html
editor: visual
self-contained: true
---

## Setup

Load packages and data:

```{r load-pkg-data}
#| message: false
# install the package 'Lahman'
install.packages('Lahman')
# load the package
library(Lahman)
```

## Exercises

### Exercise 1

```{r glimpse-data}
#good practise to lable your code chunks this way
#function to see a summary of the dataset
dplyr::glimpse(Teams)

```

The `Teams` dataset has \_**3015**\_ observations (rows) and \_**48**\_ variables(columns).

### Exercise 2

```{r filter-select}
library(dplyr)
#pipe operator (%>%) from the dplyr package is not recognized, therefore make sure to load the package 
mets <- Teams  %>% 
  dplyr::filter(teamID == "NYN")
#selects rows where the "teamID" column is equal to "NYN"
my_mets <- mets %>% 
  dplyr::filter(yearID >= 2004 & yearID <= 2012)
# Specify the years for which you want W/L records
my_mets %>% 
dplyr::select(yearID, W, L)
# Select the relevant columns

```

+---------+---------+---------+
| yearID  | W       | L       |
|         |         |         |
| \<int\> | \<int\> | \<int\> |
+========:+========:+========:+
| 2004    | 71      | 91      |
+---------+---------+---------+
| 2005    | 83      | 79      |
+---------+---------+---------+
| 2006    | 97      | 65      |
+---------+---------+---------+
| 2007    | 88      | 74      |
+---------+---------+---------+
| 2008    | 89      | 73      |
+---------+---------+---------+
| 2009    | 70      | 92      |
+---------+---------+---------+
| 2010    | 79      | 83      |
+---------+---------+---------+
| 2011    | 77      | 85      |
+---------+---------+---------+
| 2012    | 74      | 88      |
+---------+---------+---------+

**The above table shows the team W/L record during those years.**

### Exercise 3

```{r expected winning percentage}
mets_ben <- Teams |>
  dplyr::select(teamID,yearID,R,RA,G,W,L) |>
  dplyr::filter(teamID == "NYN" & yearID %in% 2004:2012)
mets_ben

dplyr::glimpse(mets_ben)

mets_ben <- mets_ben |>
  dplyr::rename(RS = R)    # new name = old name
mets_ben

```

**Runs scored and allowed are saved in a new data frame.**

+----------+---------+---------+---------+
| teamID   | yearID  | RS      | RA      |
|          |         |         |         |
| \<fctr\> | \<int\> | \<int\> | \<int\> |
+:=========+========:+========:+========:+
| NYN      | 2004    | 684     | 731     |
+----------+---------+---------+---------+
| NYN      | 2005    | 722     | 648     |
+----------+---------+---------+---------+
| NYN      | 2006    | 834     | 731     |
+----------+---------+---------+---------+
| NYN      | 2007    | 804     | 750     |
+----------+---------+---------+---------+
| NYN      | 2008    | 799     | 715     |
+----------+---------+---------+---------+
| NYN      | 2009    | 671     | 757     |
+----------+---------+---------+---------+
| NYN      | 2010    | 656     | 652     |
+----------+---------+---------+---------+
| NYN      | 2011    | 718     | 742     |
+----------+---------+---------+---------+
| NYN      | 2012    | 650     | 709     |
+----------+---------+---------+---------+

### Exercise 4

```{r mutate(actual winning percentage)}
mets_ben <- mets_ben |>
  dplyr::mutate(WPct = 1/(1+(RA/RS)^2))
mets_ben

mets_ben <- mets_ben |>
  dplyr::mutate(W_hat = WPct*G)
mets_ben

```

### Exercise 5

-   better than expected is calculated by counting the seasons where the actual wins (W) were greater than the expected wins (W_hat).

-   Worse than expected is calculated by counting the seasons where the actual wins (W) were less than the expected wins (W_hat).

Mets were better than expected in three of these seasons, and worse than expected in the other six.

### Exercise 6

```{r sorting rows}
dplyr::arrange(mets_ben,desc(WPct))
```

### Exercise 7

```{r}
mets_ben %>% 
  dplyr::mutate(Diff = WPct-W_hat) |>
  dplyr::arrange(desc(Diff))
```

### Exercise 8

```{r}
mets_ben |>
  dplyr::summarize(
    num_years = '9', 
    total_W = sum(W), 
    total_L = sum(L), 
    total_WPct = sum(WPct), 
    sum_resid = sum(WPct-W_hat)
  )

```

In these nine years, the Mets had a combined record of 728 wins and 730 losses, for an overall winning percentage of 4.559514.

### Exercise 9

```{r}

library(ggplot2)
ggplot(data = Teams, aes(x = width, y = price)) +
  geom_point() + 
  labs(
    x = "width", 
    y = "price", 
    title = "relationship between the width and price of Ikea furniture"
    )
```

### Exercise 10

```{r}
mets_ben <- mets_ben %>% 
  dplyr::mutate(
    gm = ifelse(
      yearID == 2004, 
      "Jim Duquette", 
      ifelse(
        yearID >= 2005 & yearID <=2010, "Omar Minaya",
        ifelse(yearID >=2011 & yearID <= 2012, "Sandy Alderson",NA)
      )
    )
  )
mets_ben
```

```{r}
#Alternatively

mets_ben <- mets_ben |>
  dplyr::mutate(
    gm = dplyr::case_when(
      yearID == 2004 ~ "Jim Duquette", 
      yearID >= 2005 & yearID <=2010 ~ "Omar Minaya", 
      yearID >= 2011 & yearID <= 2012 ~ "Sandy Alderson",
      TRUE ~ NA_character_
    )
  )
mets_ben

```
